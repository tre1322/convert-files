<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>File Converter</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: #f1f5f9; font-family: system-ui, sans-serif; }
    .card { border-radius: 0.75rem; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
    .dropzone {
      border: 2px dashed #cbd5e1;
      border-radius: .5rem;
      background: #f8fafc;
      padding: 18px;
      text-align: center;
      cursor: pointer;
      transition: background .15s, border-color .15s;
      min-height: 150px; /* keeps box visible without stretching */
      display: flex; flex-direction: column; justify-content: center;
    }
    .dropzone.dragover { background: #eef2ff; border-color: #6366f1; }
    .file-chip {
      display: inline-block;
      padding: .25rem .5rem;
      border-radius: 999px;
      background: #e2e8f0;
      font-size: .9rem;
      margin-top: .5rem;
    }
    @media (min-width: 992px){
      .card-equal { height: 100%; }
    }
  </style>
</head>
<body>
<div class="container py-5">
  <h2 class="mb-4 text-center">File Converter</h2>
  <div class="row g-4">
    <!-- Images card -->
    <div class="col-lg-6">
      <div class="card card-equal h-100">
        <div class="card-body">
          <h5 class="card-title mb-3">Images</h5>
          <div class="row g-3 align-items-start">
            <div class="col-6">
              <div id="imageDrop" class="dropzone">
                <p class="mb-1">Drag & Drop or Click to Browse</p>
                <input type="file" id="imageInput" accept="image/*" hidden>
                <div id="imageFileName" class="file-chip d-none"></div>
              </div>
            </div>
            <div class="col-6 d-flex flex-column">
              <label for="imageFormat" class="form-label">Convert To</label>
              <select id="imageFormat" class="form-select mb-3">
                <option value="png">PNG</option>
                <option value="jpg">JPG</option>
                <option value="webp">WEBP</option>
                <option value="tiff">TIFF</option>
              </select>
              <button class="btn btn-primary mt-auto" onclick="convertFile('image')">Convert Image</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Documents card -->
    <div class="col-lg-6">
      <div class="card card-equal h-100">
        <div class="card-body">
          <h5 class="card-title mb-3">Documents</h5>
          <div class="row g-3 align-items-start">
            <div class="col-6">
              <div id="docDrop" class="dropzone">
                <p class="mb-1">Drag & Drop or Click to Browse</p>
                <input type="file" id="docInput" accept=".pdf,.doc,.docx,.txt" hidden>
                <div id="docFileName" class="file-chip d-none"></div>
              </div>
            </div>
            <div class="col-6 d-flex flex-column">
              <label for="docFormat" class="form-label">Convert To</label>
              <select id="docFormat" class="form-select mb-3">
                <option value="pdf">PDF</option>
                <option value="docx">DOCX</option>
                <option value="txt">TXT</option>
              </select>
              <button class="btn btn-primary mt-auto" onclick="convertFile('doc')">Convert Document</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
function setupDropzone(dropId, inputId, fileNameId) {
  const dropzone = document.getElementById(dropId);
  const input = document.getElementById(inputId);
  const fileName = document.getElementById(fileNameId);

  dropzone.addEventListener('click', () => input.click());

  dropzone.addEventListener('dragover', (e) => {
    e.preventDefault();
    dropzone.classList.add('dragover');
  });
  dropzone.addEventListener('dragleave', () => dropzone.classList.remove('dragover'));
  dropzone.addEventListener('drop', (e) => {
    e.preventDefault();
    dropzone.classList.remove('dragover');
    if (e.dataTransfer.files.length) {
      input.files = e.dataTransfer.files;
      fileName.textContent = input.files[0].name;
      fileName.classList.remove('d-none');
    }
  });
  input.addEventListener('change', () => {
    if (input.files.length) {
      fileName.textContent = input.files[0].name;
      fileName.classList.remove('d-none');
    }
  });
}

setupDropzone('imageDrop', 'imageInput', 'imageFileName');
setupDropzone('docDrop', 'docInput', 'docFileName');

function convertFile(type) {
  let input, format;
  if (type === 'image') {
    input = document.getElementById('imageInput');
    format = document.getElementById('imageFormat').value;
  } else {
    input = document.getElementById('docInput');
    format = document.getElementById('docFormat').value;
  }
  if (!input.files.length) {
    alert('Please select a file first.');
    return;
  }
  const formData = new FormData();
  formData.append('file', input.files[0]);
  formData.append('to', format);

  fetch('/convert', { method: 'POST', body: formData })
    .then(res => res.blob())
    .then(blob => {
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `converted.${format}`;
      document.body.appendChild(a);
      a.click();
      a.remove();
    })
    .catch(err => alert('Conversion failed: ' + err));
}
</script>
</body>
</html>
